<!doctype html>
<html lang="fr">
<head><meta charset="UTF-8"><title>Nouveau mot de passe</title><link rel="icon" type="image/png" href="../favicon.png"></head>
<body class="auth-wrap">

<div class="card" style="max-width:420px;margin:auto;">
  <h3>Veuillez définir un nouveau mot de passe</h3>

  <form id="resetForm">
    <label>Nouveau mot de passe</label>
    <input type="password" id="pass" required>
    <button class="btn-primary" type="submit">Valider</button>
  </form>

  <div class="msg success" id="okMsg"></div>
  <div class="msg error" id="errMsg"></div>
</div>

<script>
const token = new URLSearchParams(location.search).get("token");

document.getElementById("resetForm").addEventListener("submit", async(e)=>{
  e.preventDefault();

  const res = await fetch("/api/auth/reset", {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({ token, password: pass.value })
  });

  const data = await res.json();
  if(data.success){
    okMsg.textContent = "✅ Mot de passe changé avec succès ! Maintenant vous pouvez vous connecter.";
    okMsg.style.display="block";
    setTimeout(()=>location.href="login.html", 1500);
  } else {
    errMsg.textContent = data.error;
    errMsg.style.display="block";
  }
});
</script>

</body>
</html>
