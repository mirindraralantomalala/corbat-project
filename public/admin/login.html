<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Admin — Connexion | COR'BAT</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="icon" type="image/png" href="../favicon.png">
  <style>
    /* ... (le même CSS que tu as déjà) ... */
    :root{
      --bg-1: #0f1724;
      --bg-2: #071126;
      --glass: rgba(255,255,255,0.06);
      --accent-1: #ffb400;
      --accent-2: #ff6b6b;
      --muted: #bfc7d1;
      --white-90: rgba(255,255,255,0.92);
      --success: #2ecc71;
      --danger: #ff6b6b;
      --card-radius: 14px;
      --glass-border: rgba(255,255,255,0.04);
    }
    html,body{height:100%;margin:0;font-family:'Poppins',system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background: linear-gradient(135deg,var(--bg-1) 0%, var(--bg-2) 100%);color:var(--white-90);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;}
    .auth-wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:48px 20px;box-sizing:border-box;}
    .auth-grid{width:100%;max-width:1100px;display:grid;grid-template-columns: 1fr 420px;gap:28px;align-items:center;}
    .panel{padding:36px;border-radius:var(--card-radius);background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border: 1px solid var(--glass-border);box-shadow: 0 10px 40px rgba(2,6,23,0.6), inset 0 1px 0 rgba(255,255,255,0.01);backdrop-filter: blur(6px) saturate(120%);display:flex;flex-direction:column;gap:18px;}
    .brand{display:flex;gap:14px;align-items:center;}
    .brand img{ width:56px; height:56px; object-fit:contain; border-radius:8px; }
    .brand h2{margin:0; font-size:1.4rem; letter-spacing:0.2px;background: #ffffff;-webkit-background-clip:text; -webkit-text-fill-color:transparent;}
    .panel p { margin:0; color:var(--muted); }
    .features { margin-top:8px; display:grid; gap:12px; }
    .feature { display:flex;gap:12px;align-items:flex-start; }
    .feature svg{ flex:0 0 36px; margin-top:4px; opacity:0.95; }
    .feature strong{ display:block; color:var(--white-90); }
    .feature small{ color:var(--muted); }
    .card { padding:28px; border-radius:var(--card-radius); background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02)); border: 1px solid var(--glass-border); box-shadow: 0 12px 30px rgba(2,6,23,0.6); min-height:320px; }
    .card h3 { margin:0 0 8px 0; font-size:1.25rem; color:var(--white-90); }
    .card p.lead { margin:0 0 18px 0; color:var(--muted); font-size:0.95rem; }
    .form-group { margin-bottom:14px; position:relative; }
    label { display:block; font-size:0.85rem; color:var(--muted); margin-bottom:8px; }
    input[type="email"], input[type="password"]{ width:100%; padding:12px 44px 12px 14px; border-radius:10px; border:1px solid rgba(255,255,255,0.04); background: rgba(255,255,255,0.02); color:var(--white-90); outline:none; transition: box-shadow .18s ease, transform .15s ease, border-color .15s ease; font-size:0.98rem; }
    input:focus { box-shadow: 0 6px 18px rgba(255,180,0,0.08); border-color: rgba(255,180,0,0.18); transform: translateY(-1px); }
    .input-icon { position:absolute; right:12px; top:38px; display:flex; gap:8px; align-items:center; }
    .icon-btn { background:linear-gradient(90deg,var(--accent-1),var(--accent-2)); border:none; color:var(--muted); cursor:pointer; padding:6px; border-radius:8px; display:inline-flex; align-items:center; justify-content:center; }
    .icon-btn:hover { color:var(--white-90); background: rgba(255,255,255,0.02); }
    .controls { display:flex; align-items:center; justify-content:space-between; gap:12px; margin-top:6px; }
    .checkbox { display:flex; gap:8px; align-items:center; color:var(--muted); font-size:0.95rem; }
    .forgot { color:var(--muted); text-decoration:none; font-size:0.95rem; }
    .forgot:hover { color:var(--white-90); text-decoration:underline; }
    .btn { display:inline-flex; align-items:center; gap:10px; padding:10px 14px; border-radius:10px; border:0; cursor:pointer; font-weight:600; font-size:0.98rem; transition:transform .12s ease, box-shadow .12s ease; }
    .btn:active { transform:translateY(1px); }
    .btn-primary { background: linear-gradient(90deg,var(--accent-1),var(--accent-2)); color: #111; box-shadow: 0 8px 24px rgba(255,107,107,0.12); }
    .btn-ghost { background: transparent; color:var(--muted); border: 1px solid rgba(255,255,255,0.03); padding:9px 12px; }
    .meta { display:flex; gap:10px; align-items:center; margin-top:16px; }
    .msg { margin-top:12px; padding:10px 12px; border-radius:8px; font-size:0.95rem; display:none; }
    .msg.error { background: rgba(255,107,107,0.08); color:var(--danger); display:none; border:1px solid rgba(255,107,107,0.08); }
    .msg.success { background: rgba(46,204,113,0.06); color:var(--success); display:none; border:1px solid rgba(46,204,113,0.06); }
    .loader { width:18px; height:18px; border-radius:50%; border:2px solid rgba(255,255,255,0.12); border-top-color:var(--white-90); animation:spin 0.85s linear infinite; }
    @keyframes spin { to { transform:rotate(360deg); } }
    .pw-strength { height:8px; width:100%; background:rgba(255,255,255,0.03); margin-top:8px; border-radius:6px; overflow:hidden; }
    .pw-bar { height:100%; width:0%; background:rgb(10, 110, 10); transition: width .25s ease; }
    @media (max-width:980px){ .auth-grid{ grid-template-columns: 1fr; padding:0 0; gap:18px; } }
    /* ========== MOBILE PREMIUM LOGIN ========== */
    @media (max-width: 600px) {

    .auth-wrap {
      padding: 24px 14px;
    }

    .auth-grid {
      grid-template-columns: 1fr;
      gap: 16px;
    }

    .panel {
      padding: 22px;
      border-radius: 16px;
    }

    .card {
      padding: 22px;
      border-radius: 16px;
    }

    .brand {
      justify-content: center;
      text-align: center;
    }

    .brand h2 {
      font-size: 1.2rem;
    }

    .panel p {
      text-align: center;
      font-size: 0.95rem;
    }

    .features {
      display: none; /* optionnel : masque pour alléger mobile */
    }

    .card h3 {
      text-align: center;
      font-size: 1.3rem;
    }

    .card p.lead {
      text-align: center;
      font-size: 0.95rem;
    }

    label {
      font-size: 0.8rem;
    }

    input[type="email"],
    input[type="password"] {
      padding: 14px 46px 14px 14px;
      font-size: 1rem;
      border-radius: 12px;
    }

    .controls {
      justify-content: center;
    }

    .forgot {
      font-size: 0.9rem;
    }

    .btn {
      width: 100%;
      justify-content: center;
      padding: 14px;
      font-size: 1rem;
      border-radius: 14px;
    }

    .meta {
      flex-direction: column;
      gap: 12px;
    }

    .input-icon {
      top: 42px;
    }

    .pw-strength {
      height: 6px;
    }

    /* Stack buttons vertically */
    form > div:last-of-type {
      flex-direction: column;
      gap: 12px;
    }

    #statusWrap {
      margin-left: 0 !important;
      width: 100%;
      text-align: center;
    }

    .msg {
      font-size: 0.9rem;
      text-align: center;
    }
    }
    .mobile-actions {
      display: flex;
      gap: 12px;
      align-items: center;
      margin-top: 16px;
    }

    @media (max-width: 600px) {
      .mobile-actions {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div class="auth-wrap">
    <div class="auth-grid" role="main">
      <aside class="panel" aria-labelledby="brandTitle">
        <div class="brand" id="brandTitle">
          <img src="../images/COR'BAT.png" alt="COR'BAT">
          <div>
            <h2>COR'BAT</h2>
            <p>Construction • Rénovation • Design</p>
          </div>
        </div>

        <p style="margin-top:10px;">
          Espace sécurisé réservé aux administrateurs du site. Veuillez vous authentifier pour accéder au tableau de bord.
        </p>

        <div class="features" aria-hidden="false">
          <div class="feature">
            <svg width="36" height="36" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M12 2L20 7v7c0 5-3.5 9-8 9s-8-4-8-9V7l8-5z" stroke="url(#g1)" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
              <defs><linearGradient id="g1" x1="0" x2="1"><stop offset="0" stop-color="#ffb400"/><stop offset="1" stop-color="#ff6b6b"/></linearGradient></defs>
            </svg>
            <div><strong>Sécurité</strong><small>Accès restreint, identifiants cryptés côté serveur.</small></div>
          </div>

          <div class="feature">
            <svg width="36" height="36" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M12 3v18M3 12h18" stroke="url(#g3)" stroke-width="1.2" stroke-linecap="round"/>
              <defs><linearGradient id="g3" x1="0" x2="1"><stop offset="0" stop-color="#ffb400"/><stop offset="1" stop-color="#ff6b6b"/></linearGradient></defs>
            </svg>
            <div><strong>Contrôle</strong><small>Gérez vos contenus et paramètres du site depuis le tableau de bord.</small></div>
          </div>
        </div>
      </aside>

      <section class="card" aria-labelledby="loginTitle">
        <h3 id="loginTitle">Connexion Administrateur</h3>
        <p class="lead">Identifiez-vous pour accéder au tableau de bord sécurisé.</p>

        <form id="adminLogin" novalidate>
          <div class="form-group">
            <label for="email">Adresse email</label>
            <input id="email" name="email" type="email" inputmode="email" autocomplete="email" placeholder="exemple@gmail.com" required aria-required="true" />
          </div>

          <div class="form-group" style="margin-bottom:6px">
            <label for="password">Mot de passe</label>
            <input id="password" name="password" type="password" autocomplete="current-password" placeholder="•••••••••••••" required aria-required="true" />
            <div class="input-icon" aria-hidden="true">
              <button type="button" class="icon-btn" id="togglePw" title="Afficher / masquer le mot de passe" aria-label="Afficher le mot de passe">
                <svg id="eyeOpen" width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M2 12s4-7 10-7 10 7 10 7-4 7-10 7S2 12 2 12z" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/><circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="1.2"/></svg>
              </button>
            </div>

            <div class="pw-strength" aria-hidden="true" title="Indicateur de force du mot de passe">
              <div class="pw-bar" id="pwBar" style="width:0%"></div>
            </div>
          </div>

          <div class="controls">
            <a class="forgot" href="forgot.html">Mot de passe oublié ?</a>
          </div>

          <div class="mobile-actions">
            <button type="submit" class="btn btn-primary" id="submitBtn" aria-live="polite">
              <span id="btnContent">Se connecter</span>
            </button>
            <a class="btn btn-ghost" href="../index.html" id="backBtn">Retour</a>
            <div style="margin-left:auto" id="statusWrap" aria-live="polite"></div>
          </div>

          <div class="msg error" id="errMsg" role="alert"></div>
          <div class="msg success" id="okMsg" role="status"></div>
        </form>

      </section>
    </div>
  </div>

  <script>
    (function(){
      const form = document.getElementById('adminLogin');
      const email = document.getElementById('email');
      const password = document.getElementById('password');
      const submitBtn = document.getElementById('submitBtn');
      const btnContent = document.getElementById('btnContent');
      const errMsg = document.getElementById('errMsg');
      const okMsg = document.getElementById('okMsg');
      const remember = document.getElementById('remember');
    
      function showError(text){
        errMsg.textContent = text; errMsg.style.display = 'block'; okMsg.style.display = 'none';
      }
      function showSuccess(text){
        okMsg.textContent = text; okMsg.style.display = 'block'; errMsg.style.display = 'none';
      }
    
      form.addEventListener('submit', async function(e){
        e.preventDefault();
        errMsg.style.display = 'none'; okMsg.style.display = 'none';

        submitBtn.disabled = true;
        btnContent.innerHTML = '<span class="loader"></span>';

        try {
          const res = await fetch("/api/auth/login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            credentials: "include", // permet d'envoyer/recevoir cookies
            body: JSON.stringify({ email: email.value.trim(), password: password.value })
          });

          const data = await res.json();
          if (!data.success) {
            showError(data.error || "❌ Identifiants incorrects");
            submitBtn.disabled = false;
            btnContent.textContent = "Se connecter";
            return;
          }

          showSuccess("✅ Connexion réussie");
          setTimeout(() => window.location.replace("dashboard.html"), 600);

        } catch(err) {
          showError("❌ Erreur serveur.");
          submitBtn.disabled = false;
          btnContent.textContent = "Se connecter";
        }
      });
    })();
  </script>
    
  <script>
    (function(){
      const pwInput = document.getElementById("password");
      const toggleBtn = document.getElementById("togglePw");
      const eyeOpen = document.getElementById("eyeOpen");
    
      toggleBtn.addEventListener("click", () => {
        const isHidden = pwInput.type === "password";
        pwInput.type = isHidden ? "text" : "password";
    
        // Effet visuel simple: rotation légère de l’icône
        toggleBtn.style.transform = isHidden ? "scale(1.15)" : "scale(1)";
      });
    })();
  </script>

  <script>
    (function(){
      const pw = document.getElementById("password");
      const bar = document.getElementById("pwBar");
    
      pw.addEventListener("input", () => {
        const v = pw.value;
        let strength = 0;
        if (v.length >= 6) strength++;
        if (/[A-Z]/.test(v)) strength++;
        if (/[0-9]/.test(v)) strength++;
        if (/[^A-Za-z0-9]/.test(v)) strength++;
    
        const widths = ["0%", "25%", "50%", "75%", "100%"];
        bar.style.width = widths[strength];
      });
    })();
  </script>  
</body>
</html>
